#summary Compiling a simple Android app with vs-android
#labels Phase-Deploy,Deprecated

<wiki:toc max_depth="3" />

==Installation==

  * Follow the [Installation] instructions to install vs-android. 

  * This guide also makes use of 'ant' to build a deployable .apk file. You can skip the ant-related steps if you so wish.

==Startup==

  * After you have installed vs-android, start up Visual Studio 2010.

==New Project==

  * Go to the 'File' menu, choose 'New -> Project...'

  * Pick 'Visual C++', and 'Empty Project'

  * The location you place the project isn't important. I suggest using a path that doesn't have spaces, since I haven't tested paths which contain spaces.

  * Uncheck 'Create directory for solution'. This puts the sln file and the vcxproj in the same directory. It will still create one directory off the base path you give. So in my case below, it'll end up in "C:\projects\sanangeles"

<img src="http://www.gavpugh.com/img/vs-android/NewProj.png" align="center">

==Adding Files==

  * Download [http://vs-android.googlecode.com/files/sanangeles.zip sanangeles.zip].

  * You'll want to unzip this so that the directory containing '''AndroidManifest.xml''' sits alongside the sln and vcxproj files that were just created. So that same directory would have the 'jni', 'res', and 'src' sub-directories too.

  * Go into the 'jni' directory and drag over the following files into your project as shown:

<img src="http://www.gavpugh.com/img/vs-android/DragFiles.png" align="center">

==Adding The Android Platform==

  * Now go to the 'Build' menu and pick 'Configuration Manager...'.

  * In the top right of this dialog, the solution dropdown box, choose 'New...'

<img src="http://www.gavpugh.com/img/vs-android/NewPlat.png" align="center">

  * In the next dialog choose 'Android' from the dropdown list. If it is not present, then there was a problem with installing vs-android.

  * Copy settings from 'empty', and ensure 'Create new project platforms' is checked.

<img src="http://www.gavpugh.com/img/vs-android/PickAndroid.png" align="center">

==OpenGL Support==

===Preprocessor Symbol===

  * Out of the box, the default setup doesn't hook in OpenGL support. You have to modify project settings to link in the library, and in the case of this sanangeles demo define a preprocessor symbol.

  * Right click on the 'sanangeles' project in the 'Solution Explorer' pane. This is the one that will be shown in bold, right above 'External Dependencies'. Choose 'Properties' from this menu.

  * In this dialog, navigate into the 'C++' part of the tree. Click on 'Preprocessor'.

  * In the right-hand part click on the "Preprocessor Definitions" line, and then on the little arrow that appears in the top-right corner.

  * Choose 'Edit...'

<img src="http://www.gavpugh.com/img/vs-android/prepro.png" align="center">

  * Type *DISABLE_IMPORTGL* into the top box. The 'importgl.h' header needs this defined in order to link statically with the OpenGL ES library. Click OK when you're done typing.

===Linker===

  * Navigate into the 'Linker' part of the tree now. Go to the 'Command Line' option:

<img src="http://www.gavpugh.com/img/vs-android/AddOpts.png" align="center">

  * Type *-lGLESv1_CM* into the lower box. The letter after the initial dash is a lower case 'L'. This tells the linker to link in that OpenGL library.

===Ant Build===

_(skip these steps if you do not have ant installed)_

  * In the same 'Linker' section of this properties dialog, click on 'Android Ant Build' on the left-hand side.

  * Change the top option 'Ant Build' to *ant debug*. You can just double click on the entry to cycle through the options.

  * For the 'Path To Ant Batch File', change this to the correct path of your ant.bat. If you installed ant to 'c:\ant'. It'll be 'c:\ant\bin\ant.bat'.

<img src="http://www.gavpugh.com/img/vs-android/AntDebug.png" align="center">

  * Finally, you'll also need to edit the 'local.properties' file that's at the root of the sanangeles project. There's a line denoting the path to your Android SDK. This will almost certainly be different from mine, modify it to path to your install.

<img src="http://www.gavpugh.com/img/vs-android/localprops.png" align="center">

==Building==

  * Click 'OK' to exit the properties dialog.

  * Go to the 'Build' menu. Choose 'Build Solution'.

  * It'll:
    # Compile the .c files.
    # Link the finished .so native executable.
    # Run ant to build the final deployable apk file. _(or not, if you chose to skip this)_

<img src="http://www.gavpugh.com/img/vs-android/Finished.png" align="center">

==Deploy==

If you built the apk file with ant, here are some instructions on how to deploy it.

  * Ensure you have an emulated device set up, or a real Android phone connected via debug-USB.

  * The final apk file will be placed here, from your ant build:
`sanangeles\bin\DemoActivity-debug.apk`

  * Note the path to the Android SDK that you needed to enter in the 'properties.local' file earlier. These are the two command lines to run to deploy and run the app. They assume you're in the root directory of the project.

`$(SDK_PATH)\platform-tools\adb install -r bin\DemoActivity-debug.apk`

`$(SDK_PATH)\platform-tools\adb shell am start -n com.example.SanAngeles/.DemoActivity`

  * You'll then see the demo app running on your phone!

  * You may want to put these command lines into a batch file, and set up a post-build step in Visual Studio.